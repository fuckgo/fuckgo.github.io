<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>Window认证认证介绍 | $_Fuck | 白天搞笑的废物，晚上抑郁的怪物。</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="内网渗透">
    <meta name="description" content="在了解内网渗透前，是很有必要去学习这些的。  Window密码存储地址 1%SystemRoot%\system32\config\sam  Window密码存储过程 用户输入密码 程序将密码进行NTLM算法加密为HASH值存储在SAM文件，并保存在本地SAM数据库  可以看看NTLM HASH值是怎么样的  1fuck NTLM加密后 8592e1331718673b0ee32df3c0153">
<meta name="keywords" content="内网渗透">
<meta property="og:type" content="article">
<meta property="og:title" content="Window认证认证介绍">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2020&#x2F;01&#x2F;27&#x2F;Window%E8%AE%A4%E8%AF%81%E8%AE%A4%E8%AF%81%E4%BB%8B%E7%BB%8D&#x2F;index.html">
<meta property="og:site_name" content="$_Fuck">
<meta property="og:description" content="在了解内网渗透前，是很有必要去学习这些的。  Window密码存储地址 1%SystemRoot%\system32\config\sam  Window密码存储过程 用户输入密码 程序将密码进行NTLM算法加密为HASH值存储在SAM文件，并保存在本地SAM数据库  可以看看NTLM HASH值是怎么样的  1fuck NTLM加密后 8592e1331718673b0ee32df3c0153">
<meta property="og:locale" content="zh">
<meta property="og:image" content="http:&#x2F;&#x2F;static.zybuluo.com&#x2F;1kbfree&#x2F;f1ygs3wnu6j1pyigdh36uukl&#x2F;image_1dvghvc8e14em19r11o1q1ab51qs39.png">
<meta property="og:image" content="http:&#x2F;&#x2F;static.zybuluo.com&#x2F;1kbfree&#x2F;faewul12q0qbwdmce6n1fbu7&#x2F;1.png">
<meta property="og:updated_time" content="2020-01-31T18:42:23.047Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http:&#x2F;&#x2F;static.zybuluo.com&#x2F;1kbfree&#x2F;f1ygs3wnu6j1pyigdh36uukl&#x2F;image_1dvghvc8e14em19r11o1q1ab51qs39.png">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.7.2">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" target="_blank" rel="noopener" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/blog.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">$_Fuck</h5>
          <a href="mailto:以凡人之躯比肩神明" target="_blank" rel="noopener" title="以凡人之躯比肩神明" class="mail">以凡人之躯比肩神明</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about"  >
                <i class="icon icon-lg icon-address-book"></i>
                About
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags/Web%E5%AE%89%E5%85%A8/"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/%E5%85%B4%E8%B6%A3%E7%88%B1%E5%A5%BD"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/link"  >
                <i class="icon icon-lg icon-link"></i>
                友情链接
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" target="_blank" rel="noopener" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Window认证认证介绍</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" target="_blank" rel="noopener" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" target="_blank" rel="noopener" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" target="_blank" rel="noopener" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Window认证认证介绍</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-01-26T17:01:27.000Z" itemprop="datePublished" class="page-time">
  2020-01-27
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E5%85%B4%E8%B6%A3%E7%88%B1%E5%A5%BD/">兴趣爱好</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E5%85%B4%E8%B6%A3%E7%88%B1%E5%A5%BD/%E5%A5%BD%E6%96%87/">好文</a></li></ul></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container-fluid blog body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Window密码存储地址"><span class="post-toc-number">1.</span> <span class="post-toc-text">Window密码存储地址</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Window密码存储过程"><span class="post-toc-number">2.</span> <span class="post-toc-text">Window密码存储过程</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Window登录过程"><span class="post-toc-number">3.</span> <span class="post-toc-text">Window登录过程</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Window网络认证"><span class="post-toc-number">4.</span> <span class="post-toc-text">Window网络认证</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#NTLM协议"><span class="post-toc-number">5.</span> <span class="post-toc-text">NTLM协议</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#挑战（Chalenge）和响应（Response）"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">挑战（Chalenge）和响应（Response）</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#NTLM-v2协议"><span class="post-toc-number">6.</span> <span class="post-toc-text">NTLM v2协议</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Pass-The-Hash（哈希传递）"><span class="post-toc-number">7.</span> <span class="post-toc-text">Pass The Hash（哈希传递）</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#哈希传递的要求"><span class="post-toc-number">7.1.</span> <span class="post-toc-text">哈希传递的要求</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#哈希传递原理"><span class="post-toc-number">7.2.</span> <span class="post-toc-text">哈希传递原理</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Kerberos域认证"><span class="post-toc-number">8.</span> <span class="post-toc-text">Kerberos域认证</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#活动目录（Active-Directory）概念"><span class="post-toc-number">8.1.</span> <span class="post-toc-text">活动目录（Active Directory）概念</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Kerberos认证协议"><span class="post-toc-number">8.2.</span> <span class="post-toc-text">Kerberos认证协议</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#白银票据-Silver-Tickets"><span class="post-toc-number">9.</span> <span class="post-toc-text">白银票据(Silver Tickets)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#伪造白银票据"><span class="post-toc-number">9.1.</span> <span class="post-toc-text">伪造白银票据</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#导出Server-Hash"><span class="post-toc-number">9.1.1.</span> <span class="post-toc-text">导出Server Hash</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#伪造票据"><span class="post-toc-number">9.1.2.</span> <span class="post-toc-text">伪造票据</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#白银票据防御"><span class="post-toc-number">9.2.</span> <span class="post-toc-text">白银票据防御</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#黄金票据-Golden-Tickets"><span class="post-toc-number">10.</span> <span class="post-toc-text">黄金票据(Golden Tickets)</span></a></li></ol>
        </nav>
    </aside>


<article id="post-Window认证认证介绍"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Window认证认证介绍</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-01-27 01:01:27" datetime="2020-01-26T17:01:27.000Z"  itemprop="datePublished">2020-01-27</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E5%85%B4%E8%B6%A3%E7%88%B1%E5%A5%BD/">兴趣爱好</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E5%85%B4%E8%B6%A3%E7%88%B1%E5%A5%BD/%E5%A5%BD%E6%96%87/">好文</a></li></ul></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <blockquote>
<p>在了解内网渗透前，是很有必要去学习这些的。</p>
</blockquote>
<h3 id="Window密码存储地址"><a href="#Window密码存储地址" class="headerlink" title="Window密码存储地址"></a>Window密码存储地址</h3><p><img src="http://static.zybuluo.com/1kbfree/f1ygs3wnu6j1pyigdh36uukl/image_1dvghvc8e14em19r11o1q1ab51qs39.png" alt="image_1dvghvc8e14em19r11o1q1ab51qs39.png-29.7kB"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">%SystemRoot%\system32\config\sam</span></pre></td></tr></table></figure>

<h3 id="Window密码存储过程"><a href="#Window密码存储过程" class="headerlink" title="Window密码存储过程"></a>Window密码存储过程</h3><ul>
<li>用户输入密码</li>
<li>程序将密码进行<code>NTLM</code>算法加密为<code>HASH</code>值存储在<code>SAM</code>文件，并保存在本地<code>SAM</code>数据库</li>
</ul>
<p>可以看看<code>NTLM HASH</code>值是怎么样的</p>
<p><img src="http://static.zybuluo.com/1kbfree/faewul12q0qbwdmce6n1fbu7/1.png" alt="1.png-23.9kB"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">fuck NTLM加密后 8592e1331718673b0ee32df3c0153456</span></pre></td></tr></table></figure>

<p><code>NTLM HASH</code>的前者是<code>LM HASH</code>，简单来说就是<code>LM</code>算法比<code>NTLM</code>算法垃圾，然后被淘汰，所以比较新的操作系统的密码不容易被读取出来，而<code>03</code>、<code>xp</code>系统就是使用<code>LM HASH</code>所以我们可以直接内网渗透的时候读取到原文密码而不用去跑<code>HASH</code>。</p>
<h3 id="Window登录过程"><a href="#Window登录过程" class="headerlink" title="Window登录过程"></a>Window登录过程</h3><p>当我们登录<code>window</code>系统的时候，系统会读取<code>SAM</code>文件中的密码与我们输入的密码进行验证，如果正确则成功登录。在<code>SAM</code>文件中，我们的密码是<code>NTLM HASH</code>加密的，这样子在一定的情况下保障了密码的安全。</p>
<p>更详细的就是</p>
<p>用户开机输入密码 -&gt; 系统会调用<code>winlogon.exe</code>接受用户输入的密码 -&gt; 在<code>lsass.exe</code>进程将明文密码转换成<code>NTLM HASH</code>然后读取<code>SAM</code>数据库与用户名，如果正确将<code>User SID</code>和<code>Group SID</code>传到<code>winlogon.exe</code>准备登录，如果失败则提示密码错误</p>
<blockquote>
<p><code>LSASS</code>用于本地安全和登录策略</p>
</blockquote>
<h3 id="Window网络认证"><a href="#Window网络认证" class="headerlink" title="Window网络认证"></a>Window网络认证</h3><blockquote>
<p>工作组概念（需要了解）：</p>
</blockquote>
<blockquote>
<p>工作组(Work Group)是最常见最简单最普通的资源管理模式，就是将不同的电脑按功能分别列入不同的组中，以方便管理。比如在一个网络内，可能有成百上千台工作电脑，如果这些电脑不进行分组，都列在“网上邻居”内，可想而知会有多么乱(恐怕网络邻居也会显示“下一页”吧)。为了解决这一问题，Windows 9x/NT/2000 才引用了“工作组”这个概念，比如一所高校，会分为诸如数学系、中文系之类的，然后数学系的电脑全都列入数学系的工作组中，中文系的电脑全部都列入到中文系的工作组中……如果你要访问某个系别的资源，就在“网上邻居”里找到那个系的工作组名，双击就可以看到那个系别的电脑了。</p>
</blockquote>
<p>假设<code>A</code>主机与<code>B</code>主机同在一个工作组，<code>A</code>想登录<code>B</code>，那么<code>A</code>需要知道<code>B</code>的账号密码，且<code>B</code>需要开启<code>SMB</code>服务（<code>PORT:445</code>）。</p>
<blockquote>
<p><code>SMB</code>服务主要用于文件共享</p>
</blockquote>
<h3 id="NTLM协议"><a href="#NTLM协议" class="headerlink" title="NTLM协议"></a>NTLM协议</h3><blockquote>
<p>早期<code>SMB</code>协议在网络上是明文传输的，后来出现了<code>LM</code>验证机制，但是他很简单所以可以被破解为明文，所以又推出了<code>NTLM</code></p>
</blockquote>
<p><code>NTLM</code>是一种网络认证协议，它基于<code>挑战（Chalenge）</code>和<code>响应（Response）</code>机制的协议，只支持<code>Window</code>系统</p>
<h4 id="挑战（Chalenge）和响应（Response）"><a href="#挑战（Chalenge）和响应（Response）" class="headerlink" title="挑战（Chalenge）和响应（Response）"></a><code>挑战（Chalenge）</code>和<code>响应（Response）</code></h4><p><code>NTLM</code>认证分三步：协商、质询、验证</p>
<p><strong>协商</strong>：用于确认双方协议版本（用于兼容各版本）<br><strong>质询</strong>：客户端向服务端发送用户信息请求，服务端接受请求生成一个<code>16</code>位随机数(<code>Challenge</code>)，使用用户名对应的<code>NTLM HASH</code>加密<code>Challenge</code>然后生成为<code>Challenge1</code>，然后发送给客户端，客户端接收到<code>Challenge</code>后将要登录的账户对应的<code>NTLM HASH</code>加密<code>Challenge</code>生成<code>Respone</code>并发送给服务端，服务端接受到客户端的<code>Respone</code>后，对比<code>Challenge</code>和<code>Challenge</code>是否相同，如果相同就认证成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">Challen1 &#x3D; NTLM HASH(Challenge) &#x3D; Net NTLM Hash</span></pre></td></tr></table></figure>

<p><strong>验证</strong>：质询完成后验证结果</p>
<h3 id="NTLM-v2协议"><a href="#NTLM-v2协议" class="headerlink" title="NTLM v2协议"></a>NTLM v2协议</h3><p><code>NTLM v1</code>生成的随机数是8位、<code>NTLM v2</code>的有<code>16</code>位。</p>
<p><code>v1</code>的加密算法是<code>DES</code>、<code>v2</code>的算法是<code>HMAC-MD5</code></p>
<h3 id="Pass-The-Hash（哈希传递）"><a href="#Pass-The-Hash（哈希传递）" class="headerlink" title="Pass The Hash（哈希传递）"></a>Pass The Hash（哈希传递）</h3><p>在内网横向渗透中，攻击人员经常会抓取管理员的密码和<code>NTLM HASH</code>来进行横向渗透</p>
<p>哈希传递指不需要账户明文密码的情况下完成认证，使攻击人员在渗透中获取不到明文也可以进行登录。</p>
<h4 id="哈希传递的要求"><a href="#哈希传递的要求" class="headerlink" title="哈希传递的要求"></a>哈希传递的要求</h4><p>1、需要能访问目标服务器<br>2、需要传递被认证的用户名<br>3、需要传递被认证用户的<code>NTLM HASH</code></p>
<blockquote>
<p>相当于<code>web</code>端的<code>xss</code>获取到的<code>cookie</code>，而不需要账户密码进行认证。</p>
</blockquote>
<h4 id="哈希传递原理"><a href="#哈希传递原理" class="headerlink" title="哈希传递原理"></a>哈希传递原理</h4><p>将用户名对应的<code>NTLM HASH</code>加密服务器给出的<code>Chanllenge</code>，生成一个<code>Response</code>给服务器来完成认证。</p>
<h3 id="Kerberos域认证"><a href="#Kerberos域认证" class="headerlink" title="Kerberos域认证"></a>Kerberos域认证</h3><h4 id="活动目录（Active-Directory）概念"><a href="#活动目录（Active-Directory）概念" class="headerlink" title="活动目录（Active Directory）概念"></a>活动目录（Active Directory）概念</h4><p><code>Active Directory</code>存储了有关<strong>网络对象</strong>的信息，让管理员和用户可以查找和使用执行信息</p>
<p><strong>网络对象</strong>：存储用户、用户组、计算机、域、组织单位以及安全策略…</p>
<blockquote>
<p>在一个机器上装上活动目录后，这个机器就是一个域控服务器</p>
</blockquote>
<h4 id="Kerberos认证协议"><a href="#Kerberos认证协议" class="headerlink" title="Kerberos认证协议"></a>Kerberos认证协议</h4><p>和<code>NTLM</code>一样都是认证协议，当他比<code>NTLM</code>安全</p>
<p><code>Kerberos</code>的设计目标是通过密钥系统为客户机 / 服务器应用程序提供强大的认证服务。该认证过程的实现不依赖于主机操作系统的认证，无需基于主机地址的信任，不要求网络上所有主机的物理安全，并假定网络上传送的数据包可以被任意地读取、修改和插入数据。在以上情况下， <code>Kerberos</code> 作为一种可信任的第三方认证服务，是通过传统的密码技术（如：共享密钥）执行认证服务的。</p>
<p>简要大概地说一下<code>Kerberos</code>是如何工作的：</p>
<ol>
<li>假设你要在一台电脑上访问另一个服务器（你可以发送<code>telnet</code>或类似的登录请求）。你知道服务器要接受你的请求必须要有一张<code>Kerberos</code>的“入场券”。</li>
<li>要得到这张入场券，你首先要向验证服务器（<code>AS</code>）请求验证。<strong>验证服务器会创建基于你的密码（从你的用户名而来）的一个“会话密钥”（就是一个加密密钥），并产生一个代表请求的服务的随机值。</strong>这个会话密钥就是“允许入场的入场券”。</li>
<li>然后，你把这张允许入场的入场券发到授权服务器（<code>TGS</code>）。<code>TGS</code>物理上可以和验证服务器是同一个服务器，只不过它现在执行的是另一个服务。<code>TGS</code>返回一张可以发送给请求服务的服务器的票据。</li>
<li>服务器或者拒绝这张票据，或者接受这张票据并执行服务。</li>
<li>因为你从<code>TGS</code>收到的这张票据是打上时间戳的，所以它允许你在某个特定时期内（一般是八小时）不用再验证就可以使用同一张票来发出附加的请求。使这张票拥有一个有限的有效期使其以后不太可能被其他人使用。</li>
</ol>
<p>或者如下的理解：</p>
<ol>
<li>客户机将明文密码、时间戳（使用<code>krbtgt</code>密码<code>hash</code>作为密钥）进行<code>NTLM</code>哈希加密,发送给<code>kdc</code>（域控），<code>kdc</code>对用户进行检测，成功之后创建<code>TGT(Ticket-Granting Ticket)</code></li>
<li>将<code>TGT</code>进行加密签名返回给客户机器，只有域用户<code>krbtgt</code>才能读取<code>kerberos</code>中<code>TGT</code>数据</li>
<li>然后客户机将<code>TGT</code>发送给域控制器<code>KDC</code>请求<code>TGS</code>（票证授权服务）票证，并且对<code>TGT</code>进行检测</li>
<li>检测成功之后，将目标服务账户的<code>NTLM</code>以及<code>TGT</code>进行加密，将加密后的结果返回给客户机。</li>
</ol>
<h3 id="白银票据-Silver-Tickets"><a href="#白银票据-Silver-Tickets" class="headerlink" title="白银票据(Silver Tickets)"></a>白银票据(Silver Tickets)</h3><blockquote>
<p>特点：<br>不需要与<code>KDC</code>交互<br>需要目标服务器的<code>NTLM HASH</code>（有目标服务器的权限，但是不知道明文密码，就可以用<code>NTLM HASH</code>跳过服务器认证完成认证）</p>
</blockquote>
<blockquote>
<p><code>Server Session Key</code>在未发送<code>Ticket</code>之前，服务器是不知道<code>Server Session Key</code>是什么的。 所以，一切凭据都来源于<code>Server Hash</code></p>
</blockquote>
<h4 id="伪造白银票据"><a href="#伪造白银票据" class="headerlink" title="伪造白银票据"></a>伪造白银票据</h4><p>这里使用的是<code>mimikatz.exe</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">kerberos::list #列出票据</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">kerberos::purge #清除票据</span></pre></td></tr></table></figure>

<h5 id="导出Server-Hash"><a href="#导出Server-Hash" class="headerlink" title="导出Server Hash"></a>导出Server Hash</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">mimikatz.exe &quot;privilege::debug&quot; &quot;sekurlsa::logonpasswords&quot; &quot;exit&quot; &gt; pj.txt</span></pre></td></tr></table></figure>

<h5 id="伪造票据"><a href="#伪造票据" class="headerlink" title="伪造票据"></a>伪造票据</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">mimikatz &quot;kerberos::golden &#x2F;domain:&lt;域名&gt; &#x2F;sid:&lt;域 SID&gt; &#x2F;target:&lt;目标服务器主机名&gt; &#x2F;service:&lt;服务类型&gt; &#x2F;rc4:&lt;NTLM Hash&gt; &#x2F;user:&lt;用户名&gt; &#x2F;ptt&quot; exit</span></pre></td></tr></table></figure>

<h4 id="白银票据防御"><a href="#白银票据防御" class="headerlink" title="白银票据防御"></a>白银票据防御</h4><ul>
<li>保证服务器<code>HASH</code>不被获取</li>
<li>开启<code>PAC</code>（特权属性证书保护，规定服务器必须将票据发送给<code>kerberos</code>服务并验证票据是否有效）<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">开启方法：</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">将注册表中HKEY_LOCAL_MACHINE\SYSTEM \ CurrentControlSet\Control\Lsa\Kerberos\Parameters的ValidateKdcPacSignature设置为1</span></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="黄金票据-Golden-Tickets"><a href="#黄金票据-Golden-Tickets" class="headerlink" title="黄金票据(Golden Tickets)"></a>黄金票据(Golden Tickets)</h3><blockquote>
<p>特点：</p>
<ol>
<li>需要与<code>DC</code>通信</li>
<li>需要<code>krbtgt</code>用户的<code>HASH</code></li>
</ol>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">krbtgt HASH &#x3D; KDC HASH</span></pre></td></tr></table></figure>

<p>暂未看透。待更新。</p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2020-01-31T18:42:23.047Z" itemprop="dateUpdated">2020-02-01 02:42:23</time>
</span><br>


        
        未经允许，禁止转载：<a href="/2020/01/27/Window%E8%AE%A4%E8%AF%81%E8%AE%A4%E8%AF%81%E4%BB%8B%E7%BB%8D/" target="_blank" rel="external">http://yoursite.com/2020/01/27/Window%E8%AE%A4%E8%AF%81%E8%AE%A4%E8%AF%81%E4%BB%8B%E7%BB%8D/</a>
        
    </div>
    
    <footer>
        <a href="http://yoursite.com">
            <img src="/img/blog.jpg" alt="$_Fuck">
            $_Fuck
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" target="_blank" rel="noopener" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" rel="tag">内网渗透</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://yoursite.com/2020/01/27/Window%E8%AE%A4%E8%AF%81%E8%AE%A4%E8%AF%81%E4%BB%8B%E7%BB%8D/&title=《Window认证认证介绍》 — $_Fuck&pic=http://yoursite.com/img/blog.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" target="_blank" rel="noopener" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://yoursite.com/2020/01/27/Window%E8%AE%A4%E8%AF%81%E8%AE%A4%E8%AF%81%E4%BB%8B%E7%BB%8D/&title=《Window认证认证介绍》 — $_Fuck&source=无助就算了，还要假装坚强。" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com/2020/01/27/Window%E8%AE%A4%E8%AF%81%E8%AE%A4%E8%AF%81%E4%BB%8B%E7%BB%8D/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Window认证认证介绍》 — $_Fuck&url=http://yoursite.com/2020/01/27/Window%E8%AE%A4%E8%AF%81%E8%AE%A4%E8%AF%81%E4%BB%8B%E7%BB%8D/&via=http://yoursite.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://yoursite.com/2020/01/27/Window%E8%AE%A4%E8%AF%81%E8%AE%A4%E8%AF%81%E4%BB%8B%E7%BB%8D/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" target="_blank" rel="noopener" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2020/01/30/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E9%87%8D%E5%A4%B4%E6%88%8F%E4%B9%8BCobaltstrike%E7%94%A8%E6%B3%95/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">内网渗透重头戏之Cobaltstrike用法</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2020/01/24/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E5%A4%A7%E5%90%88%E9%9B%86/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">内网穿透大合集</h4>
      </a>
    </div>
  
</nav>



    




















</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;" target="_blank" rel="noopener"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        禁止打赏~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/" data-alipay="/img/">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        
    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" target="_blank" rel="noopener" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://yoursite.com/2020/01/27/Window%E8%AE%A4%E8%AF%81%E8%AE%A4%E8%AF%81%E4%BB%8B%E7%BB%8D/&title=《Window认证认证介绍》 — $_Fuck&pic=http://yoursite.com/img/blog.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" target="_blank" rel="noopener" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://yoursite.com/2020/01/27/Window%E8%AE%A4%E8%AF%81%E8%AE%A4%E8%AF%81%E4%BB%8B%E7%BB%8D/&title=《Window认证认证介绍》 — $_Fuck&source=无助就算了，还要假装坚强。" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com/2020/01/27/Window%E8%AE%A4%E8%AF%81%E8%AE%A4%E8%AF%81%E4%BB%8B%E7%BB%8D/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Window认证认证介绍》 — $_Fuck&url=http://yoursite.com/2020/01/27/Window%E8%AE%A4%E8%AF%81%E8%AE%A4%E8%AF%81%E4%BB%8B%E7%BB%8D/&via=http://yoursite.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://yoursite.com/2020/01/27/Window%E8%AE%A4%E8%AF%81%E8%AE%A4%E8%AF%81%E4%BB%8B%E7%BB%8D/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;" target="_blank" rel="noopener"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=http://yoursite.com/2020/01/27/Window%E8%AE%A4%E8%AF%81%E8%AE%A4%E8%AF%81%E4%BB%8B%E7%BB%8D/" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.min.js?v=1.7.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.7.2" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = 'Bay！';
            clearTimeout(titleTime);
        } else {
            document.title = 'Fuck的博客~';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
